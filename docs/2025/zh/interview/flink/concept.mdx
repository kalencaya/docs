# 概念

## 架构

Client，JobManager，TaskManager



## 异步IO

场景：关联维表数据

解决同步 I/O 低吞吐的 4 种解决方案：

* 提高算子并行度。一般在 map 或者 flatmap 中关联维表数据，可通过增加并行度提高吞吐。缺点：I/O 不是 CPU 密集型工作，提高并行度没有利用好分配的 CPU 资源，存在资源浪费
* 缓存加速。一般维表数据变化频率较低，可考虑缓存数据。将较慢的存储介质缓存在快速的存储介质中，如将 mysql 中数据缓存在 redis 甚至 state 中，缓存未命中时，查询 mysql，并更新缓存。
* 异步 I/O。将同步 I/O 变为异步 I/O
* 攒批处理。类似微服务中合并接口请求，也可以在 flink 中实现每攒够 20 条数据或到达 3s，批量请求维表数据。

异步处理，使用异步 I/O 时，需数据库客户端支持异步请求，如果客户端不支持异步请求，需通过线程池将同步调用转为异步调用。

顺序性。异步 I/O 返回的数据顺序是否和同步 I/O 顺序保持一致？答案是默认是乱序的，Flink 异步 I/O 提供了两种模式：

* 有序模式。即异步 I/O 返回的数据顺序和数据处理顺序一致
* 无序模式。

异步 I/O 与事件时间。

在无序模式下，异步 I/O 返回的数据顺序和数据输入顺序不一致，而错误的事件时间会使时间窗口产出错误的结果。那么在异步 I/O 之后应用事件时间窗口是否可行？答案是可以的。虽然是无序模式，异步 I/O 算子依然可以保证事件时间下的时间窗口计算结果正确。异步 I/O 算子通过 watermark 建立数据产出顺序的边界，相邻的两个 watermark 之间的数据可能是无序的，但是同一个 watermark 前后的数据依然是有序的。



## Flink SQL

如何优化 checkpoint 过大问题，如何用 flink sql 去重